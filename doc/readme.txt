////////////////////////////////////////////////////////////////////////////////
「スレッドベースクラス、及びそこから派生させた部品クラス群について」

2010.09.26 渡辺正勝：初版
////////////////////////////////////////////////////////////////////////////////


はじめに

  このプログラム群は、POSIX pthread関数を使用したスレッドベースクラスと、
そこから派生させたTCPソケット、UDPソケット、ログ出力等の部品クラスです。

  核になるのは、スレッドセーフなメッセージキューとタイマ機能を持つスレッドベース
クラスです。その使用例として、TCPソケットクラス、UDPソケットクラス、ログクラスを
実装しました。


１．ディレクトリ構成

    thread                          ：ベースディレクトリ
      |
      + cmn                         ：共通に使用するソースプログラム（部品）
      |
      + doc                         ：ドキュメント
      |
      + log                         ：ログ出力用ディレクトリ（テスト用）
      |
      + tp_tcp                      ：TCP用テストプログラム
      |
      + tp_udp                      ：UDP用テストプログラム
      |
      + tp_tips                     ：チップス関数のテストプログラム


２．ファイルとその説明

（１）CThreadBase.h、CThreadBase.cpp
    スレッドベースクラスです。以下に特徴を列記する。
    ・スレッドセーフにメッセージ通信ができる。
    ・タイマ機能（ミリ秒単位）
    ・インスタンス管理機能

（２）CTimeVal.h
    timevalが使いにくいので、ラッピングした。

（３）CFileDescriptor.h
    select()関数使用時のファイルディスクリプタ操作が面倒なのでまとめた。

（４）CTcpListener.h、CTcpListener.cpp
    ＴＣＰリスナベースクラスです。

（５）CTcpSocket.h、CTcpSocket.cpp
    ＴＣＰソケットクラスです。

（６）CUdpSocket.h、CUdpSocket.cpp
    ＵＤＰソケットクラスです。

（７）CStrAid.h
    std::string用 補助クラスです。
    std::stringクラスにフォーマット関数がないので作りました。
    boost等を使用する場合は不要になります。
    サンプルプログラム内で使用しています。

（８）strTips.h
    文字列関連のチップス関数です。

（９）fsTips.h
    ファイル（ディレクトリ）関連のチップス関数です。

（１０）CLogThread.h、CLogThread.cpp
    ログスレッドクラスです。


３．主なサンプルプログラムとその説明

（１）CTcpEcho.h、CTcpEcho.cpp
    エコーサーバです。
    最大５ポート接続できる。
    ＴＣＰリスナベースクラスとＴＣＰソケットクラスのサンプルとなる。

（２）CTcpHealthCheck.h、CTcpHealthCheck.cpp
    ヘルスチェックスレッドクラスです。
    定期的に相手先にデータを送り、同じデータが返ってくるかチェックする。
    タイマ機能とＴＣＰソケットクラスのサンプルとなる。

（３）CUdpEcho.h
    エコーサーバです。
    ＵＤＰソケットクラスのサンプルとなる。

（４）CUdpHealthCheck.h
    ヘルスチェックスレッドクラスです。
    定期的に相手先にデータを送り、同じデータが返ってくるかチェックする。
    タイマ機能とＵＤＰソケットクラスのサンプルとなる。

（５）main.cpp
    テストプログラムです。
    起動後、エコーサーバ又はヘルスチェックを立ち上げる。
    エコーサーバとヘルスチェックは対向で動作します。


４．その他

（１）既知の問題はありません。

（２）添付の Makefile はかなりいい加減です。
      リビルドする時は、make clean して！

（３）HP-UX（aCC）では、コンパイルとリンクで、下記オプションが必要です。
      "-mt"
      "-lpthread"

以上。
